{% extends "base.html" %}

{% block title %}Pringamosa Hotel Boutique{% endblock %}

{% block body_class %}dashboard{% endblock %}

{% block main_class %}dashboard-main{% endblock %}

{% block content %}
<style>
.card-dashboard { border-radius: 10px; }
.card .card-header { border-top-left-radius: 10px; border-top-right-radius: 10px; }
</style>

<div class="container-fluid p-0">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-2 sidebar receptionist-sidebar border-end d-none d-lg-block">
            {% include 'receptionist/sidebar.html' %}
        </div>

        <!-- Main Content -->
        <div class="col-lg-10 col-12 bg-white main-content">
      <div class="py-4 px-4">
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
          <div class="text-muted small">
            <span>{{ current_time.strftime('%d/%m/%Y %H:%M') }}</span> |
             <strong>{{ current_user.get_full_name() }}</strong>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="row g-4 mb-5">
          <div class="col-md-3">
            <div class="card shadow-sm card-dashboard h-100">
              <div class="card-body text-center">
                <i class="fas fa-door-open fa-2x text-success mb-3"></i>
                <div class="h2">{{ available_rooms }}</div>
                <p class="mb-0 text-muted">Disponibles</p>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card shadow-sm card-dashboard h-100">
              <div class="card-body text-center">
                <i class="fas fa-door-closed fa-2x text-danger mb-3"></i>
                <div class="h2">{{ occupied_rooms }}</div>
                <p class="mb-0 text-muted">Ocupadas</p>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card shadow-sm card-dashboard h-100">
              <div class="card-body text-center">
                <i class="fas fa-clock fa-2x text-warning mb-3"></i>
                <div class="h2">{{ todays_checkins|length }}</div>
                <p class="mb-0 text-muted">Check-ins Pendientes</p>
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="card shadow-sm card-dashboard h-100">
              <div class="card-body text-center">
                <i class="fas fa-calendar-check fa-2x text-primary mb-3"></i>
                <div class="h2">{{ todays_checkouts|length }}</div>
                <p class="mb-0 text-muted">Check-outs Hoy</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions + Gráfico -->
        <div class="row g-4">
          <!-- Quick Actions -->
          <div class="col-md-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Acciones Rápidas</h5>
              </div>
              <div class="card-body">
                <div class="row g-2">
                  <div class="col-6 mb-2">
                    <a href="{{ url_for('receptionist.new_reservation') }}" class="btn btn-success w-100 py-2">
                      <i class="fas fa-plus-circle me-2"></i>Nueva Reserva
                    </a>
                  </div>
                  <div class="col-6 mb-2">
                    <a href="{{ url_for('receptionist.rooms') }}" class="btn btn-info w-100 py-2">
                      <i class="fas fa-bed me-2"></i>Ver Habitaciones
                    </a>
                  </div>
                  <div class="col-6 mb-2">
                    <a href="{{ url_for('receptionist.reservations') }}" class="btn btn-primary w-100 py-2">
                      <i class="fas fa-calendar-alt me-2"></i>Reservaciones
                    </a>
                  </div>
                  <div class="col-6 mb-2">
                    <a href="{{ url_for('receptionist.payments') }}" class="btn btn-secondary w-100 py-2">
                      <i class="fas fa-credit-card me-2"></i>Pagos
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Gráfico -->
          <div class="col-md-6">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Estadísticas</h5>
              </div>
              <div class="card-body">
                <canvas id="dashboardChart" width="400" height="250"></canvas>
              </div>
            </div>
          </div>
        </div> <!-- row -->
      </div> <!-- px-4 -->
    </div> <!-- col -->
</div> <!-- row -->

<!-- Mobile Sidebar -->
<div class="sidebar receptionist-sidebar d-lg-none position-fixed start-0 top-0 vh-100 bg-white shadow border-end" style="z-index: 1040; width: 250px;">
    {% include 'receptionist/sidebar.html' %}
</div>
</div> <!-- container -->

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('dashboardChart').getContext('2d');
const dashboardChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Disponibles', 'Ocupadas', 'Check-ins', 'Check-outs'],
        datasets: [{
            label: 'Cantidad',
            data: [
                {{ available_rooms }},
                {{ occupied_rooms }},
                {{ todays_checkins|length }},
                {{ todays_checkouts|length }}
            ],
            backgroundColor: [
                'rgba(40, 167, 69, 0.7)',
                'rgba(220, 53, 69, 0.7)',
                'rgba(255, 193, 7, 0.7)',
                'rgba(13, 110, 253, 0.7)'
            ],
            borderColor: [
                'rgba(40, 167, 69, 1)',
                'rgba(220, 53, 69, 1)',
                'rgba(255, 193, 7, 1)',
                'rgba(13, 110, 253, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false },
            tooltip: { enabled: true }
        },
        scales: {
            y: {
                beginAtZero: true,
                stepSize: 1
            }
        }
    }
});
</script>
{% endblock %}
